(function(h){function p(a){if(a){var b=a.data("next");for(a.data("next",null);b;)a=b.data("next"),b.data("next",null),b.remove(),b=a}}function l(a){for(;a&&m.test(a);)a=a.substr(0,a.length-4);return a}var n=h.AreaData?$.when(!0):TG.jsLoader("http://js.tgimg.cn/common/areadata.js?v=201806070930"),m=/^(?:\d*0{4})?$/,d=function(){for(var a=arguments,b=a.length,e,f,c,g=this,d=0;d<b;d++)"string"==typeof a[d]?e=a[d]:"boolean"==typeof a[d]?c=a[d]:isNaN(a[d])||(f=a[d]);this._formatVal=void 0===e?"":e;c=void 0===
c?!1:c;this.len=void 0===f?3:Math.min(f,c?4:3);this._dataStart=c?0:1;this._currentNo="";this._spanArea=$("<span/>");this._e;this._lastSelect;this._disabled=this.isReady=!1;this._disabledLen=99;n.done(function(){g._e=g._createSelect(null,g._dataStart,c?"":"0001");g._spanArea.append(g._e);g.isReady=!0;g.val(g._formatVal)})};d.prototype=new TG.Event;d.prototype.Event={CHANGE:"change"};d.prototype._createSelect=function(a,b,e){p(a);if(b<this._dataStart+this.len){var f=e?AreaData[b][e]:AreaData[b];if(!$.isEmptyObject(f)){var c=
$("<select/>").data("Index",b),g=$("<option />"),d=this;this._disabled&&b<this._dataStart+this._disabledLen&&c.attr("disabled",!0);c.append(g.clone().val(e+"0000").html("--ÇëÑ¡Ôñ--"));for(var h in f)c.append(g.clone().val(e+h).html(f[h]));a&&(a.after(c).data("next",c),c.data("prev",a));c.change(function(){d._changeHandler(this)});return c}}};d.prototype._changeHandler=function(a){this._gotoOrder(l($(a).val()));this.trigger(this.Event.CHANGE,[this._currentNo])};d.prototype.change=function(a){void 0===
a?this.trigger(this.Event.CHANGE):$.isFunction(a)&&this.bind(this.Event.CHANGE,a)};d.prototype.ready=function(a){$.isFunction(a)&&n.done(a)};d.prototype.province=function(a){if(a)if(this.isReady){var b=h.AreaData["1"],e,f;for(f in b){e=b[f];console.log(f,b[f]);for(var c in e)if(e[c]==a){this.val(f+c);return}}}else{var d=this;this.ready(function(){d.province(a)})}else if(b=this.val(),8<=b.length)return h.AreaData["1"][b.substr(0,4)][b.substr(4,4)]};d.prototype.city=function(a){if(a)if(this.isReady){var b=
h.AreaData["2"],e;e=this.val();if(8<=e.length){var f=h.AreaData["1"][e.substr(4,4)],c;for(c in f)if(f[c]==a){this.val(e.substr(0,8)+c);return}}for(var d in b)for(c in e=b[d],e)if(e[c]==a){this.val(d+c);return}}else{var k=this;this.ready(function(){k.city(a)})}else if(e=this.val(),12<=e.length)return h.AreaData["2"][e.substr(0,8)][e.substr(8,4)]};d.prototype.val=function(a){if(void 0===a||"boolean"==typeof a)return!this._lastSelect||m.test(this._currentNo)?"":a?$.trim(this._lastSelect.children("[value="+
this._currentNo+"]").html()):this._currentNo;if(this.isReady){var b="";if(a+="")if(/^\d+$/.test(a)){if(a=l(a),/^((?:\d{4})*)(\d{4})$/.test(a)){var e=RegExp.$2,d=RegExp.$1;d||(d=e,e=null);for(var c=3;0<=c;c--)if(AreaData[c][d]&&(!e||AreaData[c][d][e])){b=a;break}}}else for(c=1;c<=this.len;c++){for(e in h.AreaData[c]){var d=h.AreaData[c][e],g;for(g in d)if(d[g]&&0==d[g].indexOf(a)){b=g;break}if(b){b=e+b;break}}if(b)break}else b=1===this._dataStart?"00010000":"0000";b&&this._currentNo!=b&&this._gotoOrder(b)}else{var k=
this;this.ready(function(){k.val(a)})}};d.prototype._gotoOrder=function(a){var b=1===this._dataStart?8:4,d,f=this._dataStart,c=this._e,g;if(a){for(;a.length<b;)a+="0";for(;c&&b<=a.length;)b==a.length&&(this._lastSelect=c),d=a.substr(0,b),g=this._currentNo.substr(0,b),f++,g!=d?(c.val(d),c=this._createSelect(c,f,d)):a.length!=b&&(c=c.data("next"))||(c=this._createSelect(c,f,d)),b+=4}this._currentNo!=a&&(this._currentNo=a,this.trigger(this.Event.CHANGE,[this._currentNo]))};d.prototype.getElem=function(){return this._spanArea};
d.prototype.readOnly=function(a){this.disabled(a)};d.prototype.disabled=function(a,b){this._disabled=void 0===a?!0:a;void 0!==b&&(this._disabledLen=parseInt(b));this.isReady&&this._e.attr("disabled",this._disabled)};h.areaSelect=d})(window);
